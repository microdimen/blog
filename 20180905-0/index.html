

<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/Blog">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    <!-- Enable responsiveness on mobile devices-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

    <title> What&#x27;s happened? I have told you! </title>

    
        <link rel="apple-touch-icon" sizes="57x57" href="http:&#x2F;&#x2F;blog.microdimen.com&#x2F;apple-icon-57x57.png">
        <link rel="apple-touch-icon" sizes="60x60" href="http:&#x2F;&#x2F;blog.microdimen.com&#x2F;apple-icon-60x60.png">
        <link rel="apple-touch-icon" sizes="72x72" href="http:&#x2F;&#x2F;blog.microdimen.com&#x2F;apple-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="76x76" href="http:&#x2F;&#x2F;blog.microdimen.com&#x2F;apple-icon-76x76.png">
        <link rel="apple-touch-icon" sizes="114x114" href="http:&#x2F;&#x2F;blog.microdimen.com&#x2F;apple-icon-114x114.png">
        <link rel="apple-touch-icon" sizes="120x120" href="http:&#x2F;&#x2F;blog.microdimen.com&#x2F;apple-icon-120x120.png">
        <link rel="apple-touch-icon" sizes="144x144" href="http:&#x2F;&#x2F;blog.microdimen.com&#x2F;apple-icon-144x144.png">
        <link rel="apple-touch-icon" sizes="152x152" href="http:&#x2F;&#x2F;blog.microdimen.com&#x2F;apple-icon-152x152.png">
        <link rel="apple-touch-icon" sizes="180x180" href="http:&#x2F;&#x2F;blog.microdimen.com&#x2F;apple-icon-180x180.png">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" type="image/png" sizes="192x192"  href="http:&#x2F;&#x2F;blog.microdimen.com&#x2F;android-icon-192x192.png">
        <link rel="icon" type="image/png" sizes="32x32" href="http:&#x2F;&#x2F;blog.microdimen.com&#x2F;favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="96x96" href="http:&#x2F;&#x2F;blog.microdimen.com&#x2F;favicon-96x96.png">
        <link rel="icon" type="image/png" sizes="16x16" href="http:&#x2F;&#x2F;blog.microdimen.com&#x2F;favicon-16x16.png">
        <link rel="manifest" href="/manifest.json">
        <meta name="msapplication-TileColor" content="#ffffff">
        <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
        <meta name="theme-color" content="#ffffff">
        <meta name="description" itemprop="about" content="Blog about blockchain &amp; rust">
        <meta name="keywords" itemprop="keywords" content="blockchain, ethereum, bitcoin, rust">
        <meta itemprop="headline" content="Microdimen Blog"/>

        
            <meta itemprop="educationalUse" content="knowledge share" />
        

        
            <meta itemprop="copyrightYear" content="2018" />
        

        <!--  Social Media -->
        <meta property="og:title" content="Microdimen Blog What&#x27;s happened? I have told you! ">
        <meta property="og:description" content=" Logging in DApp development is a little bit tricky. You can’t tell if your smart contract is executed properly by the virtual machine, and the whole Ethereum network works like a black box to you. But with the help of event, you can make your life much easier. ">
        <meta property="og:image" content="&#x2F;images&#x2F;avatar.png">
        <meta property="og:url" content="http:&#x2F;&#x2F;blog.microdimen.com&#x2F;20180905-0&#x2F;">
        <meta name="twitter:card" content="summary_large_image">
        <meta property="og:site_name" content="Microdimen Blog">
        <meta name="twitter:image:alt" content="What&#x27;s happened? I have told you!">


        

        
    

    

    
        <!-- Global site tag (gtag.js) - Google Analytics --><script async src='https://www.googletagmanager.com/gtag/js?id=UA-125478797-1'></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'UA-125478797-1');</script>
    

    
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600|Source+Code+Pro">
        <link rel="stylesheet" href="http:&#x2F;&#x2F;blog.microdimen.com&#x2F;site.css">
    
</head>
<body>
    
    <div 
     itemscope itemtype="http://schema.org/Organization">
    </div>

    <header class="header">
        <div class="container">
            <a class="title" href="http:&#x2F;&#x2F;blog.microdimen.com">
                
                    
                        <img src="http:&#x2F;&#x2F;blog.microdimen.com&#x2F;images&#x2F;avatar.png" alt="">
                    
                    
                        <h1 >Microdimen Online</h1>
                    
                
            </a>
        </div>
    </header>
    <div class="container padding-header">
        
<article itemscope itemtype="http://schema.org/BlogPosting" class="post post-page">
    
        
            <meta itemprop="image" content="&#x2F;images&#x2F;avatar.png">
        
    
    <header>
        
        <h1 class="title" itemprop="headline">What&#x27;s happened? I have told you!</h1>
        <address itemprop="author" itemscope itemtype="https://schema.org/Person">
            <span itemprop="name">Wayne Song</span>
        </address>
        <div class="extra">
            

            
        </div>
    </header>
    <div itemprop="articleBody" class="body">
      <h2 id="abstract">Abstract</h2>
<p>Logging in DApp development is a little bit tricky. You can’t tell if your smart contract is executed properly by the virtual machine, and the whole Ethereum network works like a black box to you. But with the help of event, you can make your life much easier. It’s just like leaving a Trojan horse inside the network;) I have written a handy library <a href="https://github.com/microdimen/ethlogger">ethlogger</a> to simply the tedious works and any issue or PR is welcomed;)</p>
<h2 id="the-logging-system">The logging system</h2>
<h3 id="bloom-filter">Bloom Filter</h3>
<p>Suppose your boss has given you a task to filter out the junk mails from your company’s email box. What would you do? After thinking for a while, you come up with an idea. You open your favorite IDE and start typing quickly like a genius. In less than a few minutes, you create a blacklist that deals with addresses of junk mails, and some test cases. Oh yeah! Awesome! But soon you notice that the solution is not that perfect. The time complexity is O(n), which is totally terrible. Why not using a hash map? It’s O(1)! Brilliant! When you have your junk-mail-filtering algorithm rewritten, you push the code to the remote repository. Few days later, someone comes to you and complains that your code freezes his laptop. How suprised you are! What’s wrong with your perfect, elegant, and carefully tested code? The truth is that you have dismissed the effect of space complexity, which is O(n) in your algorithm. When that guy imports millions of addresses into the program, his laptop slows down due to the lack of memory.</p>
<p>The appropriate way to solve this problem is by using bloom filter. Bloom filter is similar to hash map other than that it uses several hash functions instead of one. Here is the definition from wikipedia.</p>
<blockquote>
<p>An empty Bloom filter is a bit array of m bits, all set to 0. There must also be k different hash functions defined, each of which
maps or hashes some set element to one of the m array positions, generating a uniform random distribution. Typically, k is a
constant, much smaller than m, which is proportional to the number of elements to be added; the precise choice of k and the
constant of proportionality of m are determined by the intended false positive rate of the filter.
To add an element, feed it to each of the k hash functions to get k array positions. Set the bits at all these positions to 1.</p>
</blockquote>
<p>As you see, the space complexity of bloom filter is just O(k) (k is constant). This is an example of a Bloom filter, representing the set {x, y, z}. The colored arrows show the positions in the bit array that each set element is mapped to. The element w is not in the set {x, y, z}, because it hashes to one bit-array position containing 0. For this figure, m = 18 and k = 3.</p>
<p><img src="/images/20180905_0_0.png" alt="20180905_0_0.png" /></p>
<p>Precisely speaking, bloom filter allows for false positive matches, but not false negative matches. In other words, it can check for if a value is ‘possibly in the set’ or ‘definitely not in the set’. And if you want to remove a value, you can use counting bloom filter instead.</p>
<h3 id="bloom-filter-in-ethereum">Bloom Filter in Ethereum</h3>
<p>Ethereum uses bloom filter to index the events generated by contracts. Gavin Wood, one of the Ethereum founder, specifies the algorithm of bloom filter in his yellow paper.</p>
<p><img src="/images/20180905_0_1.png" alt="20180905_0_1.png" /></p>
<p>The above specification is straightforward. Every log entry is mapped into the bloom filter from its Keccak-256 hash value. Whenever a RPC request of any event arrives, the bloom filter is searched to examine whether any valid log exists. Bloom filter is also bundled into every block header.</p>
<h2 id="listening-on-what-you-care-about">Listening on what you care about</h2>
<p>But how can we make a request to retrieve logs of an event? The answer is &quot;topic&quot;. Consider the following event.</p>
<pre style="background-color:#282828">
<span style="background-color:#282828;color:#fdf4c1aa;">event Register(uint indexed age, string indexed name, uint indexed height, string indexed job, string indexed location, string hobby)
</span></pre>
<p>It contains an event name, five indexed arguments and one normal argument. The decorator ‘indexed’ means that the argument can be used as a topic. Usually (for not-anonymous transactions) the first topic is event signature. And because it allows up to four topics in a single request, we can only use three indexed arguments at most at the same time.</p>
<pre style="background-color:#282828">
<span style="background-color:#282828;color:#fa5c4b;">struct </span><span style="background-color:#282828;color:#8ec07c;">TopicFilter </span><span style="background-color:#282828;color:#fdf4c1aa;">{
</span><span style="background-color:#282828;color:#fdf4c1aa;">    </span><span style="background-color:#282828;color:#fa5c4b;">pub </span><span style="background-color:#282828;color:#fdf4c1;">topic0</span><span style="background-color:#282828;color:#fdf4c1aa;">: Topic&lt;Hash&gt;, </span><span style="background-color:#282828;font-style:italic;color:#928374;">// event signature
</span><span style="background-color:#282828;color:#fdf4c1aa;">    </span><span style="background-color:#282828;color:#fa5c4b;">pub </span><span style="background-color:#282828;color:#fdf4c1;">topic1</span><span style="background-color:#282828;color:#fdf4c1aa;">: Topic&lt;Hash&gt;, </span><span style="background-color:#282828;font-style:italic;color:#928374;">// the first provided indexed argument
</span><span style="background-color:#282828;color:#fdf4c1aa;">    </span><span style="background-color:#282828;color:#fa5c4b;">pub </span><span style="background-color:#282828;color:#fdf4c1;">topic2</span><span style="background-color:#282828;color:#fdf4c1aa;">: Topic&lt;Hash&gt;, </span><span style="background-color:#282828;font-style:italic;color:#928374;">// the second provided indexed argument
</span><span style="background-color:#282828;color:#fdf4c1aa;">    </span><span style="background-color:#282828;color:#fa5c4b;">pub </span><span style="background-color:#282828;color:#fdf4c1;">topic3</span><span style="background-color:#282828;color:#fdf4c1aa;">: Tocpi&lt;Hash&gt;, </span><span style="background-color:#282828;font-style:italic;color:#928374;">// the third provided indexed argument
</span><span style="background-color:#282828;color:#fdf4c1aa;">}
</span></pre>
<p>Each argument is padded and hashed if necessary to produce a 32 bytes array. Then the whole TopicFilter is serialized and sent to the network via a RPC request.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Event in Ethereum is a special kind of persistent storage of smart contract. It consumes gas and cannot be emitted from a “pure” or “view” method. You can inspect how your contract behaves with the help of events.</p>
<h2 id="disclaimer">Disclaimer</h2>
<p>As you see, I’m not a native English speaker. Feel free to point out any typo or error in grammar. Thanks;)</p>

    </div>
    
      <div id='disqus_thread'></div><script>var disqus_config = function () {};(function() {var d = document, s = d.createElement('script');s.src = 'https://blogmicrodimen.disqus.com/embed.js';s.setAttribute('data-timestamp', +new Date());(d.head || d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href='https://disqus.com/?ref_noscript'>comments powered by Disqus.</a></noscript>
    
</article>


        

    </div>
</body>
</html>
